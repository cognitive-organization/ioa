# IOA v0.2 Specification — "Runtime Architecture"

**Status:** Draft
**Date:** 2026-02-25
**Author:** Paulo Lima
**Supersedes:** IOA v0.1 "Foundation"

---

## 1. Overview

IOA v0.1 "Foundation" established the doctrine (12 principles) and a declarative resource model for organizational design. It answered the question: *how do you describe an AI-native organization?*

IOA v0.2 "Runtime Architecture" answers the next question: *how do you operate one?*

The key evolution: every resource gains **spec** (desired state) and **status** (runtime state). Reconciliation loops enforce convergence between intent and reality. Agents become controllers. The organization becomes a self-correcting system.

### Three-Layer Architecture

| Layer | Scope | Package | Vendor Lock |
|-------|-------|---------|-------------|
| **Standard** | Resource model, schemas, validation | `@ioa/schemas` | None |
| **Runtime Interface** | Controller pattern, reconciliation, drift detection | `@ioa/runtime` | None |
| **Implementation** | Specific AI model integration | `@ioa/runtime-*` | By design |

This separation is the Kubernetes lesson: the API is the standard, not the kubelet. Any AI model, script, or human can implement a controller. IOA does not privilege any vendor.

### What Changes from v0.1

| Aspect | v0.1 | v0.2 |
|--------|------|------|
| Resources | 6 (Domain, Agent, Decision, Telemetry, Governance, Config) | 11 (+Workflow, Memory, Budget, SecurityPolicy, Controller) |
| State model | spec only | spec + status |
| Agent taxonomy | type (autonomy) | type (autonomy) + role (function) |
| KPI targets | Free-text strings | Structured (operator, value, unit) |
| Owner fields | Free-text strings | Structured (name, role) |
| Security | Part of Governance | First-class SecurityPolicy resource |
| Economics | Absent | First-class Budget resource |
| Orchestration | Absent | Workflow resource (DAG-based) |
| Memory | Agent field only | First-class Memory resource |
| Controller | Absent | Vendor-neutral Controller interface |
| Enforcement | Binary (valid/invalid) | Four levels (enforce/warn/advise/observe) |

---

## 2. Architecture Layers

The 12 principles from v0.1 map to 10 architectural layers. This is not a renumbering — it is a consolidation that eliminates overlap and adds missing dimensions.

| Layer | Name | Primary Resources | v0.1 Principles Covered |
|-------|------|-------------------|------------------------|
| I | Domain Architecture | Domain | P1 (Domain-First) |
| II | Agent Topology | Agent | P2 (Agent Topology), P6 (Cognitive Load) |
| III | Decision Intelligence | Decision | P3 (Decision Architecture) |
| IV | Signal Architecture | Telemetry | P4 (Event-Driven Telemetry) + P11 (Observability) — merged |
| V | Workflow Orchestration | Workflow | NEW |
| VI | Organizational Memory | Memory | P7 (Memory and Context) |
| VII | Governance | Governance | P5 (Governance by Design), P9 (Human Override) |
| VIII | Trust & Security | SecurityPolicy | NEW |
| IX | Cognitive Economics | Budget | NEW |
| X | Runtime Reconciliation | Controller | P8 (Feedback Loops), P10 (Composability), P12 (Evolutionary Architecture) |

### Consolidation Rationale

**P4 + P11 → Layer IV (Signal Architecture).** The v0.1 critique identified significant overlap between Event-Driven Telemetry and Observability First. P4 defines event schemas; P11 defines dashboards and alerts over those same events. In v0.2, they merge into "Signal Architecture" — the unified layer for event design, emission, observation, and alerting. The Telemetry resource absorbs observability fields.

**P6 → absorbed into Layer II.** Cognitive Load Distribution scored lowest in the critique (3/2/3). Its core insight — match work to cognitive complexity — is a guideline for agent design, not a standalone architectural layer. In v0.2, it becomes part of Agent Topology: agents declare their cognitive scope, and Domain.status tracks cognitiveLoadScore.

**P8, P10, P12 → Layer X (Runtime Reconciliation).** Feedback Loops, Composability, and Evolutionary Architecture describe system-level properties of the runtime, not specific resource types. They are the *how* of the control plane: feedback drives reconciliation, composability enables modular change, evolutionary architecture ensures versioned evolution.

---

## 3. Core Resource Model

### 3.1 Universal Resource Structure

Every IOA v0.2 resource follows this structure:

```yaml
apiVersion: ioa.dev/v0.2
kind: <ResourceKind>
metadata:
  name: string                    # kebab-case, unique within kind+namespace
  namespace: string               # domain name (default: "default")
  owner:                          # CHANGED: structured, not free-text
    name: string
    role: string
  labels:                         # arbitrary key-value for filtering
    key: value
  annotations:                    # non-identifying metadata
    key: value
  version: string                 # resource version (optimistic concurrency)
  createdAt: datetime
  updatedAt: datetime
spec:
  # Desired state — defined by humans or higher-level controllers
status:
  # Actual state — updated by controllers observing reality
  conditions:                     # K8s-style condition array
    - type: string
      status: "True" | "False" | "Unknown"
      reason: string
      message: string
      lastTransitionTime: datetime
```

**Design decisions:**
- `metadata.owner` is now a structured object (name + role), not a free-text string. This enables accountability tracking.
- `metadata.namespace` maps to a domain name, enabling resource scoping.
- `status.conditions` follows the Kubernetes condition pattern — a list of typed boolean conditions with reasons. This is more expressive than a single status enum.
- `metadata.version` enables optimistic concurrency control for concurrent updates.

### 3.2 Domain

The top-level bounded context. Domains are the isolation layer — no cross-domain chaos.

```yaml
apiVersion: ioa.dev/v0.2
kind: Domain
metadata:
  name: product
  owner:
    name: "Jane Smith"
    role: domain-lead
spec:
  purpose: "Core product development — features, roadmap, user experience"

  kpis:                                      # CHANGED: structured targets
    - name: feature-velocity
      target:
        operator: gte
        value: 12
        unit: features/quarter
      window: "1q"
    - name: user-satisfaction
      target:
        operator: gt
        value: 4.5
        unit: NPS
      window: "30d"

  dataOwnership:                             # CHANGED: with classification
    - name: product-catalog
      classification: internal
    - name: user-feedback
      classification: confidential
    - name: feature-flags
      classification: internal

  events:
    produces:
      - product.feature-released
      - product.feedback-analyzed
    consumes:
      - analytics.user-behavior
      - growth.churn-signal

  boundaries:
    includes:
      - Feature planning and prioritization
      - Product design and UX
      - Release management
    excludes:
      - Infrastructure operations
      - Financial reporting

  budgetRef: product-q1-budget               # NEW: reference to Budget
  securityPolicyRef: product-security        # NEW: reference to SecurityPolicy
  agents:                                    # NEW: declared agent bindings
    - product-analyst
    - product-copilot

status:
  health: healthy | degraded | critical
  costToDate:
    value: 12500
    currency: USD
    period: "2026-Q1"
  decisionVelocity:
    decisionsPerWeek: 3.2
    avgTimeToDecision: "2.5d"
  cognitiveLoadScore: 0.65                   # 0-1, from P6
  activeAgents: 2
  activeIncidents: 0
  lastEvaluation: "2026-02-25T10:00:00Z"
  conditions:
    - type: BudgetHealthy
      status: "True"
      reason: UnderThreshold
      message: "Q1 spend at 45% of budget"
      lastTransitionTime: "2026-02-25T10:00:00Z"
    - type: KPIsMet
      status: "True"
      reason: AllTargetsMet
      lastTransitionTime: "2026-02-20T10:00:00Z"
```

### 3.3 Agent

A controller operating over a domain. Agents have TWO taxonomic dimensions that are orthogonal:

- **`type`** = autonomy level (retained from v0.1): how much human oversight
- **`role`** = functional purpose (new in v0.2): what the agent does

This means an agent can be `role: analytical` + `type: autonomous` (analyzes independently) or `role: analytical` + `type: supervised` (analyzes with human approval). These are independent axes.

```yaml
apiVersion: ioa.dev/v0.2
kind: Agent
metadata:
  name: product-analyst
  owner:
    name: "Jane Smith"
    role: agent-owner
  labels:
    tier: core
spec:
  domain: product                                          # required binding

  type: autonomous | supervised | advisory | reactive      # RETAINED: autonomy level
  role: strategic | tactical | analytical | governance | observer  # NEW: function

  purpose: "Analyze user feedback and surface actionable product insights"

  model:                                                   # NEW: which AI model
    provider: anthropic
    name: claude-sonnet-4
    version: "2025-05-14"

  capabilities:                                            # CHANGED: structured
    - name: sentiment-analysis
      type: analysis
      description: "Sentiment analysis on user feedback"
    - name: feature-clustering
      type: classification
      description: "Feature request clustering and prioritization"
    - name: insight-reports
      type: generation
      description: "Weekly product insight reports"

  inputs:                                                  # NEW: formal I/O
    - name: user-feedback
      schema: product.feedback
    - name: usage-metrics
      schema: analytics.user-behavior
  outputs:
    - name: insight-report
      schema: product.insight
    - name: feature-priorities
      schema: product.priorities

  constraints:
    - "Cannot make product decisions autonomously"
    - "Must cite data sources in all recommendations"

  triggers:
    - event: product.feedback-analyzed
      action: "Update insight dashboard"
      condition: "payload.sentiment != 'neutral'"          # NEW: filter
    - event: analytics.user-behavior
      action: "Refresh usage pattern analysis"

  controller:                                              # NEW: controller interface
    watches:
      - "Domain/product"
      - "Telemetry/product.*"
    reconcileInterval: "5m"
    driftThreshold: 0.1

  governance:
    escalatesTo: product-lead
    requiresApproval: false
    auditLevel: summary

  memory:
    type: persistent
    retention: "90d"
    scope: domain                                          # NEW: scope

  tokenBudget:                                             # NEW
    maxDaily: 50000
    maxMonthly: 1000000
    alertAt: 80                                            # percentage

  schedule:                                                # NEW
    type: event-driven                                     # or continuous | cron

status:
  state: running | paused | degraded | failed | learning | idle
  lastExecution: "2026-02-25T09:45:00Z"
  avgLatency: "2.3s"
  costConsumed:
    tokens: 425000
    cost: 12.75
    currency: USD
    period: "2026-02"
  overrideRate: 0.05                                       # 5% of decisions overridden
  errorRate: 0.002
  healthScore: 94                                          # 0-100
  conditions:
    - type: Ready
      status: "True"
      reason: AllSystemsOperational
      lastTransitionTime: "2026-02-25T08:00:00Z"
    - type: BudgetHealthy
      status: "True"
      reason: Under80Percent
      lastTransitionTime: "2026-02-25T00:00:00Z"
```

### 3.4 Decision

Decisions are first-class stateful resources with full lifecycle tracking.

```yaml
apiVersion: ioa.dev/v0.2
kind: Decision
metadata:
  name: dec-001-agent-framework
  owner:
    name: "CTO"
    role: decision-maker
spec:
  id: "DEC-001"
  domain: product

  initiatedBy:                                             # NEW: structured
    type: human                                            # human | agent
    name: "CTO"
    # if agent: model, confidence fields

  date: "2026-01-15"
  reviewDate: "2026-04-15"                                 # NEW: scheduled review

  deciders:                                                # CHANGED: structured
    - name: "CTO"
      role: technical-authority
    - name: "Product Lead"
      role: domain-expert

  context: "We need to standardize AI agent governance across the organization."

  assumptions:                                             # NEW (doctrine required it)
    - id: A1
      statement: "Agent proliferation will continue to accelerate"
      status: valid                                        # valid | invalidated | untested
      validatedAt: "2026-01-10"
    - id: A2
      statement: "Engineering team is familiar with K8s-style declarative models"
      status: valid
      validatedAt: "2026-01-12"

  options:
    - name: "Ad-hoc implementation"
      description: "Each team builds agents independently"
      pros: ["Maximum flexibility", "No framework overhead"]
      cons: ["No standardization", "Governance gaps"]
      estimatedCost: "Low upfront, high long-term"
    - name: "IOA doctrine"
      description: "Adopt IOA as organizational standard"
      pros: ["Standardized model", "Built-in governance", "Validation tooling"]
      cons: ["Adoption effort", "Framework constraints"]
      estimatedCost: "Medium upfront, low long-term"

  chosen: "IOA doctrine"
  rationale: "IOA provides standardization without being overly prescriptive."

  kpiImpact:
    - kpi: feature-velocity
      expected: "+20%"
    - kpi: time-to-market
      expected: "-30% for new agents"

  reversibility: moderate                                  # easy | moderate | hard | irreversible
  relatedWorkflow: agent-onboarding                        # NEW: link to Workflow
  supersededBy: null

status:
  state: active                                            # FIXED: was missing from v0.1
  actualOutcome: "Agent deployment time reduced by 40%"    # NEW
  kpiActualImpact:                                         # NEW: measured vs expected
    - kpi: feature-velocity
      expected: "+20%"
      actual: "+18%"
      variance: "-2%"
    - kpi: time-to-market
      expected: "-30%"
      actual: "-40%"
      variance: "+10%"
  executionCost:
    value: 15000
    currency: USD
  closedAt: null
  conditions:
    - type: AssumptionsValid
      status: "True"
      reason: AllAssumptionsHold
      lastTransitionTime: "2026-02-01T00:00:00Z"
```

### 3.5 Workflow (NEW)

Multi-agent, cross-domain orchestration modeled as a directed acyclic graph (DAG).

```yaml
apiVersion: ioa.dev/v0.2
kind: Workflow
metadata:
  name: churn-response
  owner:
    name: "Growth Lead"
    role: workflow-owner
spec:
  description: "Detect churn risk, analyze context, generate retention offer, deliver"

  domainsInvolved:
    - growth
    - product
    - analytics

  trigger:
    event: growth.churn-signal
    condition: "payload.riskLevel >= 'high'"

  steps:                                                   # DAG, not sequence
    - name: classify
      agent: growth-optimizer
      action: classify-churn-risk
      timeout: "5m"
      retryPolicy:
        maxRetries: 2
        backoff: "30s"
      onFailure: abort

    - name: analyze
      agent: data-pipeline
      action: compile-churn-context
      dependsOn: [classify]                                # DAG edge
      timeout: "3m"
      onFailure: skip

    - name: offer
      agent: product-analyst
      action: generate-retention-offer
      dependsOn: [classify, analyze]                       # waits for both
      timeout: "10m"
      onFailure: abort

    - name: deliver
      agent: growth-optimizer
      action: deliver-offer
      dependsOn: [offer]
      timeout: "2m"
      onFailure: compensate

  compensation:
    - step: deliver
      action: cancel-pending-offer
      agent: growth-optimizer
    - step: offer
      action: log-missed-opportunity
      agent: insight-reporter

  timeout: "30m"
  failurePolicy: compensate

status:
  state: idle | queued | executing | blocked | completed | failed | compensating
  currentStep: "offer"
  completedSteps: ["classify", "analyze"]
  failedSteps: []
  startedAt: "2026-02-25T14:00:00Z"
  completedAt: null
  retries: 0
  latency: "8m32s"
  costAccumulated:
    tokens: 15000
    cost: 0.45
    currency: USD
  conditions:
    - type: StepsHealthy
      status: "True"
      reason: NoFailures
      lastTransitionTime: "2026-02-25T14:08:00Z"
```

### 3.6 Memory (NEW)

Long-term organizational context. Storage-agnostic — the schema defines what to remember, not how to store it.

```yaml
apiVersion: ioa.dev/v0.2
kind: Memory
metadata:
  name: product-context-q1
  owner:
    name: "Product Lead"
    role: context-owner
spec:
  domain: product
  scope: domain                                            # agent-private | domain | organization

  entries:
    - key: "q1-product-strategy"
      value:
        focus: "retention over acquisition"
        rationale: "Churn rate exceeds target"
        approved: true
      source:
        type: decision
        ref: "Decision/dec-002-q1-strategy"
      validUntil: "2026-04-01"
      confidence: 0.95
      tags: ["strategy", "q1", "retention"]

    - key: "top-feature-requests"
      value:
        - "API access"
        - "Mobile app"
        - "SSO integration"
      source:
        type: agent
        ref: "Agent/product-analyst"
      validUntil: "2026-03-15"
      confidence: 0.82
      tags: ["features", "user-feedback"]

  relatedDecisions:
    - dec-001-agent-framework
    - dec-002-q1-strategy
  relatedAgents:
    - product-analyst

  retention:
    policy: review-based                                   # ttl | permanent | review-based
    reviewInterval: "30d"

  storage:                                                 # AGNOSTIC
    type: structured                                       # structured | vector | hybrid | graph
    queryCapabilities:
      - key-value
      - temporal-range

status:
  entryCount: 2
  indexed: true
  lastAccessed: "2026-02-25T09:00:00Z"
  lastUpdated: "2026-02-20T14:00:00Z"
  sizeBytes: 2048
  compressionState: none                                   # none | compressed | archived
  conditions:
    - type: EntriesFresh
      status: "True"
      reason: AllWithinValidity
      lastTransitionTime: "2026-02-25T00:00:00Z"
```

### 3.7 Budget (NEW)

Cognitive economics. No unbounded intelligence burn.

```yaml
apiVersion: ioa.dev/v0.2
kind: Budget
metadata:
  name: product-q1-budget
  owner:
    name: "CFO"
    role: budget-owner
spec:
  domain: product

  period:
    start: "2026-01-01"
    end: "2026-03-31"

  limits:
    tokenLimit: 5000000
    costThreshold:
      value: 25000
      currency: USD
    maxCostPerDecision:
      value: 500
      currency: USD

  alerts:
    - at: 50
      channel: slack
      severity: warning
    - at: 80
      channel: slack
      severity: critical
    - at: 95
      channel: pagerduty
      severity: critical

  roiExpectations:
    - metric: feature-velocity
      target: "+20%"
      baseline: "10 features/quarter"
    - metric: decision-time
      target: "-30%"
      baseline: "5 days avg"

status:
  tokensConsumed: 2100000
  costToDate:
    value: 12500
    currency: USD
  costPerDecision:
    avg: 125
    p95: 380
  utilizationPercent: 50
  efficiencyScore: 0.78                                    # cost-adjusted output quality
  projectedOverrun: false
  projectedOverrunDate: null
  conditions:
    - type: WithinBudget
      status: "True"
      reason: Under80Percent
      lastTransitionTime: "2026-02-25T00:00:00Z"
```

### 3.8 SecurityPolicy (NEW)

Trust layer. Agent identity, data scopes, zero-trust, prompt security.

```yaml
apiVersion: ioa.dev/v0.2
kind: SecurityPolicy
metadata:
  name: product-security
  owner:
    name: "Security Lead"
    role: security-officer
spec:
  domain: product                                          # or "*" for org-wide

  agentIdentity:
    authMethod: token                                      # token | certificate | oauth
    rotationPolicy: "90d"

  dataScopes:
    - classification: public
      allowedAgentTypes: [autonomous, supervised, advisory, reactive]
      allowedRoles: [strategic, tactical, analytical, governance, observer]
      requiresApproval: false
    - classification: internal
      allowedAgentTypes: [supervised, advisory, reactive]
      allowedRoles: [strategic, tactical, analytical]
      requiresApproval: false
    - classification: confidential
      allowedAgentTypes: [supervised]
      allowedRoles: [analytical, governance]
      requiresApproval: true
    - classification: restricted
      allowedAgentTypes: []
      allowedRoles: [governance]
      requiresApproval: true

  zeroTrust:
    enabled: true
    eventProvenance: required                              # required | optional
    crossDomainPolicy: allow-listed                        # deny-all | allow-listed | open
    allowedDomains:
      - analytics
      - growth

  promptSecurity:
    injectionDefense: standard                             # basic | standard | strict
    inputValidation: true
    outputSanitization: true
    maxPromptLength: 32000

  audit:
    enabled: true
    retention: "365d"
    level: full
    immutable: true                                        # tamper-proof log

  humanOverride:
    enabled: true
    channels: [dashboard, cli, slack]
    maxResponseTime: "15m"
    testFrequency: "monthly"

status:
  complianceScore: 92
  violations:
    total: 3
    critical: 0
    lastViolation: "2026-02-18T11:23:00Z"
  lastAudit: "2026-02-20T00:00:00Z"
  lastOverrideTest: "2026-02-01T00:00:00Z"
  conditions:
    - type: Compliant
      status: "True"
      reason: ScoreAboveThreshold
      lastTransitionTime: "2026-02-20T00:00:00Z"
```

### 3.9 Governance (EVOLVED)

In v0.2, Governance focuses on access control, escalation, and compliance. Security concerns moved to SecurityPolicy. Gains policy inheritance.

```yaml
apiVersion: ioa.dev/v0.2
kind: Governance
metadata:
  name: product-governance
  owner:
    name: "Product Lead"
    role: governance-owner
spec:
  domain: product
  extends: org-default-governance                          # NEW: policy inheritance

  accessControl:
    roles:
      - name: admin
        permissions: [read, write, deploy, override, delete, admin]
      - name: operator
        permissions: [read, write, deploy]
      - name: viewer
        permissions: [read]
    defaultRole: viewer

  promptVersioning:
    enabled: true
    repository: "prompts/"

  escalation:                                              # NEW: structured paths
    paths:
      - level: 1
        role: domain-lead
        channel: slack
        timeout: "15m"
      - level: 2
        role: vp-engineering
        channel: pagerduty
        timeout: "30m"
      - level: 3
        role: cto
        channel: phone
        timeout: "1h"
    defaultPath: "level-1"

  compliance:                                              # NEW
    standards: ["SOC2", "GDPR"]
    requirements:
      - "All agent actions must be auditable"
      - "PII access requires explicit consent"

status:
  activePolicies: 1
  overrideFrequency: 0.5                                   # per week
  escalationRate: 0.1                                      # per week
  complianceStatus: compliant                              # compliant | non-compliant | under-review
  conditions:
    - type: PolicyActive
      status: "True"
      reason: InheritedAndOverridden
      lastTransitionTime: "2026-02-01T00:00:00Z"
```

### 3.10 Telemetry (EVOLVED — "Signal Architecture")

Merges Event-Driven Telemetry (P4) and Observability First (P11) into a single resource with structured alert rules and correlation support.

```yaml
apiVersion: ioa.dev/v0.2
kind: Telemetry
metadata:
  name: product-feature-released
  owner:
    name: "Product Lead"
    role: signal-owner
spec:
  event: "product.feature_released"
  category: metric                                         # metric | log | trace | alert | audit
  severity: info                                           # NEW: info | warning | error | critical
  description: "Emitted when a new feature is released to production"

  payload:
    type: object
    properties:
      featureName:
        type: string
      releaseDate:
        type: string
        format: date
      rolloutPercentage:
        type: number
    required: [featureName, releaseDate]

  metricsImpacted:
    - feature-velocity
    - time-to-market

  source:
    domain: product
    agent: product-analyst

  correlationId:                                           # NEW
    required: true
    format: uuid

  retention:                                               # NEW
    duration: "180d"
    archiveAfter: "90d"

  observability:                                           # EXPANDED
    dashboard: true
    alertRule:                                              # CHANGED: structured
      condition:
        metric: "events.count"
        operator: lt
        value: 2
        window: "30d"
      severity: warning
      channels: [slack]

status:
  eventRate: 3.2                                           # events per day
  lastEmitted: "2026-02-24T16:00:00Z"
  errorRate: 0.0
  avgPayloadSize: 256
  conditions:
    - type: EmittingNormally
      status: "True"
      reason: WithinExpectedRate
      lastTransitionTime: "2026-02-24T16:00:00Z"
```

### 3.11 Controller (NEW — Runtime Layer)

The vendor-neutral interface for reconciliation. A Controller watches resources, detects drift, and takes corrective action.

```yaml
apiVersion: ioa.dev/v0.2
kind: Controller
metadata:
  name: product-controller
  owner:
    name: "Product Lead"
    role: controller-owner
spec:
  agent: product-analyst                                   # which Agent implements this

  watches:
    - resource: "Domain/product"
      events: [status.health, status.costToDate]
    - resource: "Telemetry/product.*"
      events: [all]
    - resource: "Budget/product-q1-budget"
      events: [status.utilizationPercent]

  reconciliation:
    interval: "5m"
    driftThreshold: 0.1
    mode: automatic | approval-required | advisory

  actions:
    - type: update-status
      scope: "Domain/product"
    - type: emit-telemetry
      scope: "Telemetry/product.*"
    - type: create-memory
      scope: "Memory/product-*"
    - type: escalate
      scope: "*"

  governance:
    maxActionsPerCycle: 10
    requiresApproval: [modify-spec, override-agent, trigger-workflow]
    auditAll: true

status:
  lastReconciliation: "2026-02-25T14:55:00Z"
  driftDetected: false
  actionsPerformed: 3
  reconciliationLatency: "1.2s"
  cyclesSinceLastDrift: 48
  conditions:
    - type: Reconciling
      status: "True"
      reason: NoDriftDetected
      lastTransitionTime: "2026-02-25T14:55:00Z"
```

---

## 4. Controller Interface

### 4.1 Reconciliation Loop

Every controller follows the same lifecycle:

```
Watch → Diff → Plan → Act → Report
```

1. **Watch**: Observe resources declared in `spec.watches`
2. **Diff**: Compare spec (desired state) against status (actual state)
3. **Plan**: Determine reconciliation actions needed
4. **Act**: Execute actions (subject to governance constraints)
5. **Report**: Update resource status, emit telemetry events, create memory entries

This loop runs at `spec.reconciliation.interval`. The controller only acts when drift exceeds `spec.reconciliation.driftThreshold`.

### 4.2 Drift Types

| Drift Type | Description | Default Response |
|-----------|-------------|-----------------|
| `performance` | KPI below target | Alert + plan |
| `cost` | Budget utilization above threshold | Alert + throttle |
| `compliance` | Security or governance violation | Block + escalate |
| `health` | Agent or domain degraded | Diagnose + recover |
| `staleness` | Decision or memory past review date | Warn |
| `orphan` | Agent references nonexistent domain | Warn + escalate |

### 4.3 Reconciliation Actions

| Action | Description | Approval Required |
|--------|-------------|------------------|
| `update-status` | Refresh status from runtime data | No |
| `emit-telemetry` | Generate telemetry event | No |
| `create-memory` | Store context entry | No |
| `escalate` | Notify human via governance channels | No |
| `modify-spec` | Change resource desired state | **Yes** |
| `trigger-workflow` | Start a workflow execution | Depends on workflow |
| `override-agent` | Pause or reconfigure an agent | **Yes** |

### 4.4 Controller Modes

The `spec.reconciliation.mode` determines autonomy:

| Mode | Behavior | Maps to Agent Type |
|------|----------|--------------------|
| `automatic` | Act immediately on drift | `autonomous` |
| `approval-required` | Plan actions, wait for human approval | `supervised` |
| `advisory` | Report drift and recommendations only | `advisory` |

---

## 5. Enforcement Model

IOA does NOT rigidly refuse all non-compliant actions. Instead, it uses graduated enforcement:

| Level | Behavior | When Applied |
|-------|----------|-------------|
| **Enforce** | Block the action, require correction | SecurityPolicy violations, budget hard limits, schema validation failures |
| **Warn** | Allow but log warning, increment violation counter | Soft budget thresholds, missing recommended fields, suboptimal configurations |
| **Advise** | Suggest improvement in status/telemetry | Missing optional best practices, potential optimizations |
| **Observe** | Silent telemetry only | Normal operations, baseline data collection |

**Rationale:** Rigidity drives abandonment. IOA should make the right thing easy, not the wrong thing impossible — except where security demands it.

### 5.1 Graceful Degradation

Every IOA system must function without AI agents:

- Manual override paths exist for every automated process (SecurityPolicy.humanOverride)
- Workflows have human-executable fallback procedures
- Decisions can be made without agent input
- The system degrades to "manual organization" — slower but functional
- Override paths are tested at SecurityPolicy.humanOverride.testFrequency

---

## 6. Migration from v0.1

### 6.1 Backward Compatibility

- v0.1 resources with `apiVersion: ioa.dev/v0.1` remain valid
- `ioa validate` accepts both v0.1 and v0.2 resources
- `ioa migrate` transforms v0.1 → v0.2:
  - Adds empty `status` blocks
  - Restructures `metadata.owner` from string to `{name, role}`
  - Restructures KPI targets from string to `{operator, value, unit}`
  - Wraps `dataOwnership` strings with `{name, classification: "internal"}`
  - Adds `active` to Decision status enum
- No breaking changes to v0.1 consumers

### 6.2 New CLI Commands

| Command | Description | Release |
|---------|-------------|---------|
| `ioa migrate` | Migrate v0.1 resources to v0.2 | v0.2.0 |
| `ioa drift` | Detect spec/status drift across resources | v0.2.2 |
| `ioa reconcile` | Run one reconciliation cycle | v0.2.2 |
| `ioa budget` | Display budget utilization dashboard | v0.2.1 |
| `ioa security` | Run security compliance scan | v0.2.1 |

---

## 7. Release Plan

v0.2 is delivered incrementally:

| Release | Content | Theme |
|---------|---------|-------|
| **v0.2.0** | spec/status on existing resources, Decision schema fixes (active, assumptions, actualOutcome), Workflow resource, structured KPIs/owner, ioa migrate | Core model evolution |
| **v0.2.1** | Budget resource, SecurityPolicy resource, data classification, ioa budget, ioa security | Economics & Security |
| **v0.2.2** | Memory resource, Controller interface, drift detection, ioa drift, ioa reconcile | Runtime foundation |
| **v0.3.0** | Reference runtime implementation (`@ioa/runtime-claude`), reconciliation engine, agent-as-controller end-to-end | First runtime |

Each release:
- Passes `ioa validate` on all examples
- Includes migration tooling from previous version
- Ships updated doctrine content reflecting changes
- Maintains backward compatibility with previous versions

---

## 8. Explicit Scope Boundaries

v0.2 does NOT include:

| Excluded | Reason | Planned For |
|----------|--------|-------------|
| Specific AI model coupling | Standard is vendor-neutral | v0.3 (as implementation, not standard) |
| Real-time event streaming | IOA validates contracts, not transport | Out of scope |
| Agent-to-agent direct messaging | Agents communicate via events | Evaluate for v0.3 |
| Multi-organization federation | Single org scope | Evaluate for v0.4 |
| UI/Dashboard | CLI-first | Community project |
| Running daemon/process | IOA is invoked on-demand | v0.3 (runtime package) |

---

## 9. Resource Summary

| Resource | Layer | New? | Key v0.2 Changes |
|----------|-------|------|-------------------|
| Domain | I | No | +status, +structured KPIs, +budgetRef, +securityPolicyRef, +data classification |
| Agent | II | No | +status, +role (orthogonal to type), +model, +controller, +structured capabilities, +tokenBudget, +schedule, +inputs/outputs |
| Decision | III | No | +status block, +active/reversed states, +assumptions, +actualOutcome, +initiatedBy, +reviewDate |
| Telemetry | IV | No | +status, +correlationId, +retention, +severity, +structured alertRule, +audit category |
| Governance | VII | No | +status, +extends (inheritance), +structured escalation, +compliance |
| Workflow | V | **Yes** | DAG-based multi-agent orchestration with compensation logic |
| Memory | VI | **Yes** | Storage-agnostic organizational context with structured entries |
| Budget | IX | **Yes** | Token/cost limits with ROI tracking, alerts, efficiency scoring |
| SecurityPolicy | VIII | **Yes** | Agent identity, data scopes, zero-trust, prompt security, override testing |
| Controller | X | **Yes** | Vendor-neutral reconciliation interface with drift detection |
| Config | — | No | +schemaVersion, +defaultGovernance, +defaultSecurityPolicy |

---

## 10. Design Principles for the Spec Itself

These meta-principles guide how v0.2 was designed:

1. **Spec is intent, status is reality.** Humans and high-level controllers write spec. Controllers and the runtime update status. Never mix them.

2. **References over embedding.** Resources reference each other by name (`budgetRef: product-q1-budget`), not by inlining the full resource. This enables independent lifecycle management.

3. **Structured over free-text.** Where v0.1 used strings (KPI targets, owners, permissions), v0.2 uses structured objects. Structured data enables automation.

4. **Orthogonal dimensions over flat enums.** Agent type (autonomy) and role (function) are independent axes. Don't collapse distinct concepts into a single taxonomy.

5. **Progressive enforcement.** Enforce security. Warn on best practices. Advise on optimizations. Observe everything else.

6. **Vendor-neutral standard, vendor-specific runtime.** The schema is the standard. The controller implementation is pluggable.

7. **Incremental delivery over big bang.** Four releases (v0.2.0 → v0.2.1 → v0.2.2 → v0.3.0), each independently valuable.

---

*IOA v0.2 "Runtime Architecture" — from organizational documentation to organizational control plane.*
